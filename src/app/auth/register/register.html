<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ getRoleContent().roleText }} Registration - StrayRescue</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="register.css">
</head>
<body>

    <div class="register-container">
        <header class="page-header">
            <a [routerLink]="['/']" class="back-link"><i class="fas fa-arrow-left"></i> Back to Home</a>
            <div class="dropdown">
                <button class="dropdown-toggle">
                    <i class="fas fa-users"></i> {{ getRoleContent().roleText }} <i class="fas fa-chevron-down"></i>
                </button>
                <div class="dropdown-menu">
                    <a class="dropdown-item" (click)="changeRole('volunteer')">Volunteer</a>
                    <a class="dropdown-item" (click)="changeRole('admin')">Admin</a>
                    <a class="dropdown-item" (click)="changeRole('user')">User</a>
                </div>
            </div>
        </header>

        <main class="form-wrapper">
            <div class="form-box">
                <h2>{{ getRoleContent().title }}</h2>
                <p class="subtitle">{{ getRoleContent().subtitle }}</p>

                <!-- 1. Bind the form to the FormGroup and handle submission -->
                <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
                    <!-- Full Name -->
                    <div class="input-group">
                        <label for="fullName">Full Name</label>
                        <div class="input-field">
                            <i class="fas fa-user"></i>
                            <!-- 2. Bind the input to the form control -->
                            <input type="text" id="fullName" placeholder="Enter your full name" formControlName="fullName">
                        </div>
                        <!-- 3. Add validation message block -->
                        <div *ngIf="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched" class="error-message">
                            <div *ngIf="registerForm.get('fullName')?.errors?.['required']">Full name is required.</div>
                        </div>
                    </div>

                    <!-- Mobile Number -->
                    <div class="input-group">
                        <label for="mobile">Mobile Number</label>
                        <div class="input-field">
                            <i class="fas fa-phone"></i>
                            <input type="tel" id="mobile" placeholder="Enter your mobile number" formControlName="mobileNumber">
                        </div>
                        <div *ngIf="registerForm.get('mobileNumber')?.invalid && registerForm.get('mobileNumber')?.touched" class="error-message">
                            <div *ngIf="registerForm.get('mobileNumber')?.errors?.['required']">Mobile number is required.</div>
                            <div *ngIf="registerForm.get('mobileNumber')?.errors?.['pattern']">Please enter a valid mobile number.</div>
                        </div>
                    </div>

                    <!-- Email Address -->
                    <div class="input-group">
                        <label for="email">Email Address</label>
                        <div class="input-field">
                            <i class="fas fa-envelope"></i>
                            <input type="email" id="email" placeholder="e.g., example@gmail.com" formControlName="email">
                        </div>
                        <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched" class="error-message">
                            <div *ngIf="registerForm.get('email')?.errors?.['required']">Email address is required.</div>
                            <div *ngIf="registerForm.get('email')?.errors?.['email']">Please enter a valid email address.</div>
                        </div>
                    </div>

                    <!-- Password -->
                    <div class="input-group">
                        <label for="password">Password</label>
                        <div class="input-field">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="password" placeholder="Create a password" formControlName="password">
                            <button type="button" class="password-toggle"><i class="fas fa-eye"></i></button>
                        </div>
                        <div *ngIf="registerForm.get('password')?.invalid && registerForm.get('password')?.touched" class="error-message">
                            <div *ngIf="registerForm.get('password')?.errors?.['required']">Password is required.</div>
                            <div *ngIf="registerForm.get('password')?.errors?.['minlength']">Password must be at least 8 characters long.</div>
                        </div>
                        <!-- You can make this criteria list dynamic based on validation state later if desired -->
                        <div class="password-criteria">
                            <span><i class="fas fa-check-circle"></i> At least 8 characters</span>
                            <!-- Add other criteria checks as needed -->
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="input-group">
                        <label for="confirmPassword">Confirm Password</label>
                        <div class="input-field">
                            <i class="fas fa-lock"></i>
                            <input type="password" id="confirmPassword" placeholder="Confirm your password" formControlName="confirmPassword">
                            <button type="button" class="password-toggle"><i class="fas fa-eye"></i></button>
                        </div>
                        <div *ngIf="registerForm.get('confirmPassword')?.touched && registerForm.get('confirmPassword')?.invalid" class="error-message">
                            <div *ngIf="registerForm.get('confirmPassword')?.errors?.['required']">Please confirm your password.</div>
                        </div>
                        <!-- 4. Show password mismatch error -->
                        <div *ngIf="registerForm.hasError('passwordMismatch') && registerForm.get('confirmPassword')?.touched" class="error-message">
                            Passwords do not match.
                        </div>
                    </div>

                    <!-- 5. Display server-side errors -->
                    <div *ngIf="errorMessage" class="error-message server-error">
                        {{ errorMessage }}
                    </div>

                    <!-- 6. Disable button when form is invalid -->
                    <button type="submit" class="btn-primary" [disabled]="registerForm.invalid">{{ getRoleContent().buttonText }}</button>

                    <p class="signin-link">
                        Already have an account? <a [routerLink]="['/signin', selectedRole]">Sign in here</a>
                    </p>
                </form>
            </div>
        </main>
    </div>

</body>
</html>